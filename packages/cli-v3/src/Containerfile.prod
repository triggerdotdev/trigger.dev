FROM node:alpine@sha256:d3271e4bd89eec4d97087060fd4db0c238d9d22fcfad090a73fa9b5128699888

RUN apk add --no-cache dumb-init

ENV TRIGGER_API_URL=__API_URL__
ENV TRIGGER_API_KEY=__API_KEY__
ENV TRIGGER_CONTENT_HASH=__CONTENT_HASH__
ENV TRIGGER_PROJECT_DIR=__PROJECT_DIR__
ENV TRIGGER_PROJECT_REF=__PROJECT_REF__
ENV TRIGGER_CLI_PACKAGE_VERSION=__CLI_PACKAGE_VERSION__

WORKDIR /app

COPY --chown=node:node . .

USER node

CMD [ "dumb-init", "node", "index.mjs" ]