import ProjectPathArg from "/snippets/cli-args-project-path.mdx";
import CommonOptions from "/snippets/cli-options-common.mdx";
import ProjectRefOption from "/snippets/cli-options-project-ref.mdx";
import EnvFileOption from "/snippets/cli-options-env-file.mdx";
import ConfigFileOption from "/snippets/cli-options-config-file.mdx";
import SkipUpdateCheckOption from "/snippets/cli-options-skip-update-check.mdx";
import BranchOption from "/snippets/cli-options-branch.mdx";

Run the command like this:

<CodeGroup>

```bash npm
npx trigger.dev@latest deploy
```

```bash pnpm
pnpm dlx trigger.dev@latest deploy
```

```bash yarn
yarn dlx trigger.dev@latest deploy
```

</CodeGroup>

<Warning>
  This will fail in CI if any version mismatches are detected. Ensure everything runs locally first
  using the [dev](/cli-dev-commands) command and don't bypass the version checks!
</Warning>

It performs a few steps to deploy:

1. Optionally updates packages when running locally.
2. Compiles and bundles the code.
3. Deploys the code to the Trigger.dev instance.
4. Registers the tasks as a new version in the environment (prod by default).

## Deploying from CI

When deploying from CI/CD environments such as GitHub Actions, GitLab CI, or Jenkins, you need to authenticate non-interactively by setting the `TRIGGER_ACCESS_TOKEN` environment variable. Please see the [CI / GitHub Actions guide](/github-actions) for more information.

## Arguments

```
npx trigger.dev@latest deploy [path]
```

<ProjectPathArg />

## Options

<ConfigFileOption />

<ProjectRefOption />

<EnvFileOption />

<SkipUpdateCheckOption />

<ParamField body="Environment" type="--env | -e">
  Defaults to `prod` but you can specify `staging` or `preview`. If you specify `preview` we will
  try and automatically detect the branch name from git.
</ParamField>

<BranchOption />

<ParamField body="Dry run" type="--dry-run">
  Create a deployable build but don't deploy it. Prints out the build path so you can inspect it.
</ParamField>

<ParamField body="Skip promotion" type="--skip-promotion">
  Skips automatically promoting the newly deployed version to the "current" deploy.
</ParamField>

<ParamField body="Skip syncing env vars" type="--skip-sync-env-vars">
  Turn off syncing environment variables with the Trigger.dev instance.
</ParamField>

### Common options

These options are available on most commands.

<CommonOptions />

### Self-hosting

These options are used when [self-hosting](/open-source-self-hosting) or for local development.

<ParamField body="Local build" type="--local-build">
  Build the deployment image locally using your local Docker instead of using the remote build service.
</ParamField>

<ParamField body="Load image" type="--load">
  Load the built image into your local Docker after building it.
</ParamField>

<ParamField body="Push image" type="--push">
  Push the image to the registry after building locally.
</ParamField>

<ParamField body="Network" type="--network">
  The networking mode for RUN instructions when building locally. Options: `default`, `none`, `host`.
</ParamField>

<ParamField body="Native build server" type="--native-build-server">
  Use the native build server for building the image. This uploads your project files and builds remotely.
</ParamField>

<ParamField body="Detach" type="--detach">
  Return immediately after the deployment is queued, without waiting for the build to complete. Implies `--native-build-server`.
</ParamField>

## Examples

### Self-hosted deployment

For self-hosted deployments, set your `TRIGGER_ACCESS_TOKEN` and use the `--api-url` option to point to your self-hosted instance:

```bash
TRIGGER_ACCESS_TOKEN=your_token npx trigger.dev@latest deploy --api-url https://your-trigger-instance.com
```

### Local build with Docker

Build the image locally and load it into your local Docker:

```bash
npx trigger.dev@latest deploy --local-build --load
```

### Local build and push to registry

Build the image locally and push it to your configured registry:

```bash
npx trigger.dev@latest deploy --local-build --push
```
