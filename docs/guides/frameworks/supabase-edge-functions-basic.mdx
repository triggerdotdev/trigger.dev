---
title: "Triggering tasks from Supabase edge functions"
sidebarTitle: "Edge functions - basic"
description: "This guide will show you how to trigger a task from a Supabase edge function, and then view the run."
---

import Prerequisites from "/snippets/framework-prerequisites.mdx";
import CliInitStep from "/snippets/step-cli-init.mdx";
import CliDevStep from "/snippets/step-cli-dev.mdx";
import CliRunTestStep from "/snippets/step-run-test.mdx";
import CliViewRunStep from "/snippets/step-view-run.mdx";
import UsefulNextSteps from "/snippets/useful-next-steps.mdx";
import TriggerTaskNextjs from "/snippets/trigger-tasks-nextjs.mdx";
import NextjsTroubleshootingMissingApiKey from "/snippets/nextjs-missing-api-key.mdx";
import NextjsTroubleshootingButtonSyntax from "/snippets/nextjs-button-syntax.mdx";
import WorkerFailedToStartWhenRunningDevCommand from "/snippets/worker-failed-to-start.mdx";

## Overview

Supabase edge functions allow you to trigger tasks either when an event is sent from a third party (e.g. when a new Stripe payment is processed, when a new user signs up to a service, etc), or when there are any changes or updates to your Supabase database.

This guide shows you how to set up and deploy a simple Supabase edge function example that triggers a task when an edge function URL is accessed.

## Prerequisites

- You must have the [Supabase CLI](https://supabase.com/docs/guides/cli/getting-started) installed
- [Create a Supabase project](https://supabase.com/docs/guides/functions/quickstart#initialize-a-project) on your local machine
- Ensure TypeScript is installed
- [Create a Trigger.dev account](https://cloud.trigger.dev)
- [Create a new Trigger.dev project](/guides/dashboard/creating-a-project)

## Initial setup

<Steps>
  <CliInitStep />
  <CliDevStep />
  <CliRunTestStep />
  <CliViewRunStep />
</Steps>

## Create a new Supabase edge function and deploy it to production

<Steps>

<Step title="Optional step: create a new Supabase project">

If you don't already have a Supabase project, create one by running the following command in your terminal:

```bash
supabase init
```

<Info>
  If using VS Code, ensure to answer 'y' when asked to generate VS Code settings for Deno, and
  install any recommended extensions.
</Info>

</Step>

<Step title="Create a new Supabase edge function">

In your project, run the following command in the terminal. We'll call this example `edge-function-trigger`. :

```bash
supabase functions new edge-function-trigger
```

</Step>

<Step title="Update the edge function code">

Replace the placeholder code in your `edge-function-trigger/index.ts` file with the following:

```ts supabase/edge-function-trigger/index.ts
import "jsr:@supabase/functions-js/edge-runtime.d.ts";
// Update the import path to use the correct version of the SDK
import { tasks } from "npm:@trigger.dev/sdk@3.0.0-beta.55/v3";
// NB: Import your task type from your /trigger folder
import type { helloWorldTask } from "../../../src/trigger/example.mjs";

Deno.serve(async (req) => {
  await tasks.trigger<typeof helloWorldTask>("edge-function-trigger", "hello");
  return new Response("OK");
});
```

<Note>You can only import the `type` from the task.</Note>
<Note>
  Tasks in the `trigger` folder use Node, so they must stay in there or they will not run,
  especially if you are using a different runtime like Deno. Also do not add "`npm:`" to imports
  inside your task files, for the same reason.
</Note>

</Step>

<Step title="Add a .env file to be able to test locally">

First, go to your Trigger.dev project and copy the `dev` secret key from the API keys page.

![How to find your dev secret key](/images/api-key-dev.png)

Then create an `.env` file in the functions folder, and add your `TRIGGER_SECRET_KEY`.

```ts functions/.env
TRIGGER_SECRET_KEY = "your-secret-key";
```

<Warning>
  If you are using GitHub - make sure to include `.env` in your `.gitignore` file before committing
  any files to GitHub.
</Warning>

</Step>

<Step title="Test your new edge function locally">

To do this, open up two terminal windows in your project.

In the first terminal window run:

<CodeGroup>

```bash npm
npx trigger.dev@beta dev
```

```bash pnpm
pnpm dlx trigger.dev@beta dev
```

```bash yarn
yarn dlx trigger.dev@beta dev
```

</CodeGroup>

The CLI `dev` command runs a server for your tasks. It watcbes for changes in your `/trigger` directory and communicates with the Trigger.dev platform to register your tasks, perform runs, and send data back and forth.

In the second terminal run this command:

```bash
supabase functions serve edge-function-trigger
```

Click the link provided to open the preview URL, making sure to add your function name to the end:

`http://127.0.0.1:54321/functions/v1/<function-name>`

So in this case:

`http://127.0.0.1:54321/functions/v1/edge-function-trigger`

When the URL is opened, your `hello-world` task should be triggered, and you should see `"OK"` in your browser window.

Check the first terminal window to see if the task has run successfully. You can also check the [cloud.trigger.dev](http://cloud.trigger.dev) runs dashboard to see if there has been a successful run.

</Step>
</Steps>

## Deploy your new Supabase edge function and Trigger.dev task to production and trigger a task

Now that your edge function is working in dev, you can deploy it to production.

<Steps>

<Step title="Add your Trigger.dev prod secret key in Supabase">

Go to your Trigger.dev project and copy the `prod` secret key from the API keys page.

![How to find your prod secret key](/images/api-key-prod.png)

Then, in Supabase, navigate to your settings page, click 'Edge functions' in the configurations menu, and then click the 'Add new secret' button.

Add `TRIGGER_SECRET_KEY` with the pasted value of your Trigger.dev `prod` secret key.

![Add secret key in Supabase](/images/supabase-keys-1.png)

</Step>

<Step title="Deploy your edge function using the Supabase CLI">

Go back to your project, and deploy your edge function with the following command:

```bash
supabase functions deploy edge-function-trigger --no-verify-jwt
```

<Note>
  `--no-verify-jwt` removes the JSON Web Tokens requirement from the authorization header. By
  default this should be on, but it is not required for this example. Learn more about JWTs
  [here](https://supabase.com/docs/guides/auth/jwts).
</Note>

Follow the CLI instructions and once complete you should now see your new edge function deployment in your Supabase edge functions dashboard.

Your new `edge-function-trigger` edge function is now ready to trigger your `hello-world` task.

</Step>

<Step title="Deploy your 'Hello World' task">

Deploy your `hello-world` task to [Trigger.dev cloud](https://cloud.trigger.dev).

<CodeGroup>

```bash npm
npx trigger.dev@beta deploy
```

```bash pnpm
pnpm dlx trigger.dev@beta deploy
```

```bash yarn
yarn dlx trigger.dev@beta deploy
```

</CodeGroup>

</Step>

<Step title="Trigger a prod run from your deployed edge function">

To do this all you need to do is simply open the `edge-function-trigger` URL.

On your Supabase dashboard, go to your Edge function dashboard, copy the URL, and paste it into your browser.

Once loaded you should see ‘OK’ on the new screen.

![Edge function URL](/images/supabase-function-url.png)

The task will be triggered when your edge function URL is accessed.

Check your [cloud.trigger.dev](http://cloud.trigger.dev) dashboard and you should see a succesful `hello-world` task.

    **Congratulations, you have run a simple Hello World task from a Supabase edge function!**

</Step>
</Steps>

<UsefulNextSteps />
