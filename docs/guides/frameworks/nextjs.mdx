---
title: "Next.js setup guide"
sidebarTitle: "Next.js"
description: "This guide will show you how to setup Trigger.dev in your existing Next.js project, test an example task, and view the run."
icon: "N"
---

import Prerequisites from '/snippets/framework-prerequisites.mdx';
import CliInitStep from '/snippets/step-cli-init.mdx';
import CliDevStep from '/snippets/step-cli-dev.mdx';
import CliRunTestStep from '/snippets/step-run-test.mdx';
import CliViewRunStep from '/snippets/step-view-run.mdx';
import UsefulNextSteps from '/snippets/useful-next-steps.mdx';
import NextjsTroubleshooting from '/snippets/nextjs-missing-api-key.mdx';

<Note>This guide can be followed for both App and Pages router as well as Server Actions.</Note>

<Prerequisites framework="Next.js" />

## Initial setup

<Steps>
  <CliInitStep />
  <CliDevStep />
  <CliRunTestStep />
  <CliViewRunStep />
</Steps>

## Set your secret key locally

Set your `TRIGGER_SECRET_KEY` environment variable in your `.env.local` file if using the Next.js App router or `.env` file if using Pages router. This key is used to authenticate with Trigger.dev, so you can trigger runs from your Next.js app. Visit the API Keys page in the dashboard and select the DEV secret key.

![How to find your secret key](/images/api-keys.png)

For more information on authenticating with Trigger.dev, see the [API keys page](/apikeys).

## Triggering your task in Next.js

Here are the steps to trigger your task in the Next.js App and Pages router and Server Actions.

<Tabs>

  <Tab title="App Router">

      1. Add a Route Handler by creating a `route.ts` file (or `route.js` file if using JavaScript) in the `app/api` directory like this: `app/api/hello-world/route.ts`.
      2. Then add this example code to `route.ts` to trigger your task:

      ```ts app/api/hello-world/route.ts
      // Next.js API route support: https://nextjs.org/docs/api-routes/introduction
      import type { helloWorldTask } from "@/trigger/example";
      import { tasks } from "@trigger.dev/sdk/v3";
      import { NextResponse } from "next/server";

      export async function GET(request: Request) {
        const handle = await tasks.trigger<typeof helloWorldTask>(
          "hello-world",
          "James"
        );

        return NextResponse.json(handle);
      }
      ```

    </Tab>

    <Tab title="App Router (Server Actions)">

      1. Then add this example code to `route.ts` to trigger your task:
      2. Create a button on a page in your app with an `onClick` event that triggers your task. Make sure to import your task and include `"use client";` at the top of your file.

      ```ts app/api/hello-world/route.ts
      // Next.js API route support: https://nextjs.org/docs/api-routes/introduction
      import type { helloWorldTask } from "@/trigger/example";
      import { tasks } from "@trigger.dev/sdk/v3";
      import { NextResponse } from "next/server";

      export async function GET(request: Request) {
        const handle = await tasks.trigger<typeof helloWorldTask>(
          "hello-world",
          "James"
        );

        return NextResponse.json(handle);
      }
      ```

    </Tab>

    <Tab title="Pages Router">

      Create an API route in the `pages/api` directory. Here's an example of how you can trigger your task in the Pages router:

      ```ts pages/api/hello.ts
      // Next.js API route support: https://nextjs.org/docs/api-routes/introduction
      import { helloWorldTask } from "@/trigger/example";
      import { tasks } from "@trigger.dev/sdk/v3";
      import type { NextApiRequest, NextApiResponse } from "next";

      export default async function handler(
        req: NextApiRequest,
        res: NextApiResponse<{ id: string }>
      ) {
        const handle = await tasks.trigger<typeof helloWorldTask>(
        "hello-world",
        "James"
        );

        res.status(200).json(handle);   
      }
      ```
    </Tab>

</Tabs>

## Add your environment variables (optional)

If you have any environment variables in your tasks, be sure to add them in the dashboard so the deployed code runs successfully. In Node.js, these environment variables are accessed in your code using `process.env.MY_ENV_VAR`.

In the sidebar select the "Environment Variables" page, then press the "New environment variable"
button. ![Environment variables page](/images/environment-variables-page.jpg)

You can add values for your local dev environment, staging and prod. ![Environment variables
page](/images/environment-variables-panel.jpg)

You can also add environment variables in code by following the steps on the [Environment Variables page](/deploy-environment-variables#in-your-code).

## Deploying your task in Next.js

For this guide, we'll manually deploy your task by running the [CLI deploy command](/cli-deploy) below. Other ways to deploy are listed in the next section.

<CodeGroup>

```bash npm
npx trigger.dev@beta deploy
```

```bash pnpm
pnpm dlx trigger.dev@beta deploy
```

```bash yarn
yarn dlx trigger.dev@beta deploy
```

</CodeGroup>

### Other ways to deploy

<Tabs>

<Tab title="GitHub Actions">

Use GitHub Actions to automatically deploy your tasks whenever new code is pushed to the `main` branch and when the `trigger` directory has changes in it. Follow [this guide](/github-actions) to set up GitHub Actions.

</Tab>

<Tab title="Vercel Integration">

We're working on adding an official [Vercel integration](/vercel-integration) which you can follow the progress of [here](https://feedback.trigger.dev/p/vercel-integration-3).

</Tab>

</Tabs>

## Troubleshooting

    <NextjsTroubleshooting/>

<UsefulNextSteps />
