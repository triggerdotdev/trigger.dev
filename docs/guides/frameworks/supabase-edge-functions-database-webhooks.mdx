---
title: "Triggering tasks from Supabase database webhooks"
sidebarTitle: "Edge functions - database webhooks"
description: "This guide will show you how to trigger a task from a Supabase edge function, and then view the run."
---

import Prerequisites from "/snippets/framework-prerequisites.mdx";
import SupabasePrerequisites from "/snippets/supabase-prerequisites.mdx";
import CliInitStep from "/snippets/step-cli-init.mdx";
import CliDevStep from "/snippets/step-cli-dev.mdx";
import CliRunTestStep from "/snippets/step-run-test.mdx";
import CliViewRunStep from "/snippets/step-view-run.mdx";
import UsefulNextSteps from "/snippets/useful-next-steps.mdx";
import TriggerTaskNextjs from "/snippets/trigger-tasks-nextjs.mdx";
import NextjsTroubleshootingMissingApiKey from "/snippets/nextjs-missing-api-key.mdx";
import NextjsTroubleshootingButtonSyntax from "/snippets/nextjs-button-syntax.mdx";
import WorkerFailedToStartWhenRunningDevCommand from "/snippets/worker-failed-to-start.mdx";

## Overview

Database webhooks allow you to send realtime data from your database to another system whenever an event occurs in your table e.g. when a row is inserted, updated, or deleted, or when a specific column is updated.

This guide shows you how to set up and deploy a simple Supabase edge function that triggers a "Hello world" task every time a new row is inserted into your database.

## Prerequisites

- Ensure you have the [Supabase CLI](https://supabase.com/docs/guides/cli/getting-started) installed
- Ensure TypeScript is installed
- [Create a Trigger.dev account](https://cloud.trigger.dev)
- [Create a new Trigger.dev project](/guides/dashboard/creating-a-project)

## Initial setup

<Steps>
  <SupabasePrerequisites />
  <CliInitStep />
  <CliDevStep />
  <CliRunTestStep />
  <CliViewRunStep />
</Steps>

## Create and deploy a new Supabase edge function and create a new database webhook

<Steps>

<Step title="Add your Trigger.dev prod secret key in Supabase">

First, go to your Trigger.dev project and copy the `prod` secret key from the API keys page.

![How to find your prod secret key](/images/api-key-prod.png)

Then, in Supabase, navigate to your 'Project settings' page, click 'Edge functions' in the configurations menu, and then click the 'Add new secret' button.

Add `TRIGGER_SECRET_KEY` with the pasted value of your Trigger.dev `prod` secret key.

![Add secret key in Supabase](/images/supabase-keys-1.png)

</Step>

<Step title="Create a new edge function using the Supabase CLI">

Go back to your project, and create a new edge function. We will call it `database-webhook`.

```bash
supabase functions new database-webhook
```

</Step>

<Step title="Update the edge function code">

Replace the `database-webhook` placeholder code with the following:

```ts /database-webhook/index.ts
import "jsr:@supabase/functions-js/edge-runtime.d.ts";
import { tasks } from "npm:@trigger.dev/sdk@3.0.0-beta.55/v3";
// Import your task type from your /trigger folder
import { helloWorldTask } from "../../../src/trigger/example.ts";

console.log("Hello from 'database-webhook' function!");

Deno.serve(async (req) => {
  const payload = await req.json();
  await tasks.trigger<typeof helloWorldTask>("hello-world", "hello");
  console.log(payload ?? "No name provided");

  return new Response("ok");
});
```

<Note>You can only import the `type` from the task.</Note>
<Note>
  Tasks in the `trigger` folder use Node, so they must stay in there or they will not run,
  especially if you are using a different runtime like Deno. Also do not add "`npm:`" to imports
  inside your task files, for the same reason.
</Note>

</Step>

<Step title="Deploy your edge function using the Supabase CLI">

Now deploy your edge function with the following command:

```bash
supabase functions deploy edge-function-trigger
```

Follow the CLI instructions and once complete you should see your new edge function deployment in your Supabase edge functions dashboard.

</Step>

<Step title="Create a new database">

Next, in your Supabase dashboard, click on 'Table Editor' in the left-hand menu and create a new table. In this example we will call our table `skynet`.

![How to create a new table](/images/supabase-new-table-1.png)

Add a new column called `name` with the type `text`.

![How to add a new column](/images/supabase-new-table-2.png)

</Step>

<Step title="Configure JWT settings">

By default, Supabase edge functions require a JSON Web Token (JWT) in the authorization header. This is to ensure that only authorized users can access your edge functions.

In your Supabase dashboard, click 'Project settings', then the 'API' tab, and copy the `anon` `public` API key from the table.

![How to find your Supabase API keys](/images/supabase-api-key.png)

Then, go to 'Database' click on 'Webhooks', and then click 'Create a new hook'.

![How to create a new webhook](/images/supabase-create-webhook-1.png)

1. Call the hook `edge-function-hook`:
2. Select the new table you have created: `public` `skynet`.
3. Choose the `insert` event.
4. Under 'Webhook configuration', select 'Supabase Edge functions'
5. Under 'Edge function', choose `POST` and select the edge function you have created: `database-webhook`.
6. Under 'Headers', add a new header with the key `Authorization` and the value `Bearer <your-api-key>` (replace `<your-api-key>` with the `anon` `public` API key you copied earlier).
7. Click 'Create webhook'.

![How to create a new webhook 2](/images/supabase-create-webhook-2.png)
![How to create a new webhook 3](/images/supabase-create-webhook-3.png)

</Step>

</Steps>

## Deploy your 'Hello World' task and trigger it from your new `database-webhook` edge function

<Steps>

<Step title="Deploy your 'Hello World' task">

Go back to your project and deploy your `hello-world` task to [Trigger.dev cloud](https://cloud.trigger.dev).

<CodeGroup>

```bash npm
npx trigger.dev@beta deploy
```

```bash pnpm
pnpm dlx trigger.dev@beta deploy
```

```bash yarn
yarn dlx trigger.dev@beta deploy
```

</CodeGroup>

</Step>

<Step title="Trigger your new database webhook edge function">

Back in your Supabase dashboard, click on 'Table Editor' in the left-hand menu, and then click on the `skynet` table.

![How to insert a new row 1](/images/supabase-new-table-3.png)

Click 'insert', and add a new item under `name`, with the value `Sarah Connor`.

![How to insert a new row 2](/images/supabase-new-table-4.png)

Go back to your edge function dashboard, and you should see a new run of your `database-webhook` edge function, under 'Logs'.

![How to view the logs](/images/supabase-logs.png)

Check your [cloud.trigger.dev](http://cloud.trigger.dev) dashboard and you should see a succesful `hello-world` task.

**Congratulations, you have successfully triggered a task from a Supabase edge function using a database webhook!**

</Step>

</Steps>

<UsefulNextSteps />
